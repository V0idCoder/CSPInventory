<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.image.ImageView?>
<?import javafx.scene.layout.*?>

<BorderPane xmlns="http://javafx.com/javafx/21" xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="com.cspinventory.controller.MainController"
            stylesheets="@main-view.css"
            styleClass="page-root">

    <top>
        <VBox spacing="14" alignment="CENTER" BorderPane.alignment="CENTER">
            <padding>
                <Insets top="6" right="4" bottom="4" left="4"/>
            </padding>

            <GridPane styleClass="header-shell">
                <columnConstraints>
                    <ColumnConstraints hgrow="ALWAYS"/>
                    <ColumnConstraints minWidth="280"/>
                </columnConstraints>

                <VBox spacing="3">
                    <Label text="Machines" styleClass="page-title"/>
                    <Label fx:id="machinesCountLabel" text="0 machines" styleClass="muted-text"/>
                    <Label fx:id="databaseStatusLabel" text="Backup session: aucun chargement" styleClass="muted-text"/>
                </VBox>

                <HBox spacing="8" GridPane.columnIndex="1" alignment="BOTTOM_RIGHT">
                    <Button text="⟳" onAction="#onRefresh" styleClass="icon-btn">
                        <tooltip>
                            <Tooltip text="Rafraichir"/>
                        </tooltip>
                    </Button>
                    <Button text="+" onAction="#onNewMachine" styleClass="icon-btn">
                        <tooltip>
                            <Tooltip text="Ajouter"/>
                        </tooltip>
                    </Button>
                    <Button text="↓" onAction="#onExportExcel" styleClass="icon-btn">
                        <tooltip>
                            <Tooltip text="Exporter Excel"/>
                        </tooltip>
                    </Button>
                    <Button fx:id="restoreBackupButton" text="⤒ Backup" onAction="#onRestoreBackup" styleClass="secondary-btn">
                        <tooltip>
                            <Tooltip text="Charger une sauvegarde .db"/>
                        </tooltip>
                    </Button>
                    <Button fx:id="deleteButton" text="Supprimer" onAction="#onDeleteMachine" styleClass="secondary-btn"/>
                </HBox>
            </GridPane>
        </VBox>
    </top>

    <center>
        <VBox spacing="14" fillWidth="true" alignment="TOP_CENTER">
            <StackPane fx:id="contentStack" VBox.vgrow="ALWAYS" minHeight="0">
                <GridPane hgap="16" vgap="0" maxWidth="1820" maxHeight="1.7976931348623157E308">
                    <rowConstraints>
                        <RowConstraints vgrow="ALWAYS" fillHeight="true"/>
                    </rowConstraints>
                    <columnConstraints>
                        <ColumnConstraints percentWidth="74" hgrow="ALWAYS"/>
                        <ColumnConstraints percentWidth="26" minWidth="320" prefWidth="340"/>
                    </columnConstraints>

                    <VBox GridPane.columnIndex="0" spacing="10" styleClass="card-pane table-card" GridPane.vgrow="ALWAYS" minHeight="0">
                        <HBox spacing="6" alignment="CENTER_LEFT" styleClass="search-box">
                            <Label text="⌕" styleClass="search-icon"/>
                            <TextField fx:id="searchField" promptText="Filtre texte sur champs principaux" styleClass="search-field" HBox.hgrow="ALWAYS"/>
                        </HBox>

                        <TableView fx:id="machineTable" VBox.vgrow="ALWAYS" styleClass="machine-table" minHeight="0">
                            <columns>
                                <TableColumn fx:id="nomReseauColumn" text="Nom reseau" prefWidth="180"/>
                                <TableColumn fx:id="serieColumn" text="Serie" prefWidth="140"/>
                                <TableColumn fx:id="modelColumn" text="Modele" prefWidth="140"/>
                                <TableColumn fx:id="utilisateurColumn" text="Utilisateur" prefWidth="140"/>
                                <TableColumn fx:id="emplacementColumn" text="Emplacement" prefWidth="140"/>
                                <TableColumn fx:id="ipv4Column" text="IPv4 RJ45" prefWidth="140"/>
                                <TableColumn fx:id="ipv4WifiColumn" text="IPv4 Wifi" prefWidth="140"/>
                                <TableColumn fx:id="garantieColumn" text="Garantie" prefWidth="90"/>
                            </columns>
                        </TableView>
                    </VBox>

                    <VBox GridPane.columnIndex="1" spacing="12" styleClass="card-pane side-card" GridPane.vgrow="ALWAYS" minHeight="0">
                        <Label text="Fiche rapide" styleClass="card-title"/>
                        <Label text="Selectionne une machine pour voir les details." styleClass="muted-text" wrapText="true"/>

                        <GridPane hgap="8" vgap="7">
                            <columnConstraints>
                                <ColumnConstraints minWidth="120" prefWidth="120"/>
                                <ColumnConstraints hgrow="ALWAYS"/>
                            </columnConstraints>

                            <Label text="Nom reseau" styleClass="muted-text" GridPane.rowIndex="0"/>
                            <Label fx:id="selectedNomReseauLabel" text="-" GridPane.columnIndex="1" GridPane.rowIndex="0"/>

                            <Label text="Serie" styleClass="muted-text" GridPane.rowIndex="1"/>
                            <Label fx:id="selectedSerieLabel" text="-" GridPane.columnIndex="1" GridPane.rowIndex="1"/>

                            <Label text="Modele" styleClass="muted-text" GridPane.rowIndex="2"/>
                            <Label fx:id="selectedModelLabel" text="-" GridPane.columnIndex="1" GridPane.rowIndex="2"/>

                            <Label text="Utilisateur" styleClass="muted-text" GridPane.rowIndex="3"/>
                            <Label fx:id="selectedUtilisateurLabel" text="-" GridPane.columnIndex="1" GridPane.rowIndex="3"/>

                            <Label text="Emplacement" styleClass="muted-text" GridPane.rowIndex="4"/>
                            <Label fx:id="selectedEmplacementLabel" text="-" GridPane.columnIndex="1" GridPane.rowIndex="4"/>

                            <Label text="Mise en service" styleClass="muted-text" GridPane.rowIndex="5"/>
                            <Label fx:id="selectedDateMiseEnServiceLabel" text="-" GridPane.columnIndex="1" GridPane.rowIndex="5"/>

                            <Label text="Derniere modif" styleClass="muted-text" GridPane.rowIndex="6"/>
                            <Label fx:id="selectedDateModifLabel" text="-" GridPane.columnIndex="1" GridPane.rowIndex="6"/>
                        </GridPane>

                        <StackPane prefHeight="150" minHeight="150" styleClass="image-placeholder">
                            <ImageView fx:id="selectedModelImageView"
                                       fitHeight="136"
                                       fitWidth="280"
                                       preserveRatio="true"
                                       smooth="true"
                                       pickOnBounds="true"/>
                            <Label fx:id="selectedModelImagePlaceholder" text="Apercu modele" styleClass="muted-text"/>
                        </StackPane>

                        <Label text="Note" styleClass="muted-text"/>
                        <Label fx:id="selectedNoteLabel" text="-" wrapText="true" VBox.vgrow="ALWAYS"/>

                        <Button fx:id="openSheetButton" text="Ouvrir la fiche" onAction="#onOpenSelectedMachine" styleClass="primary-btn" maxWidth="1.7976931348623157E308"/>
                    </VBox>
                </GridPane>

                <StackPane fx:id="formOverlay" styleClass="overlay-backdrop" visible="false" managed="false">
                    <VBox fx:id="formHost" styleClass="overlay-shell" maxWidth="1240" maxHeight="820"/>
                </StackPane>
            </StackPane>

            <TilePane hgap="12" vgap="12" prefColumns="4" prefTileWidth="290" maxWidth="1820" styleClass="widgets-shell" tileAlignment="TOP_LEFT" VBox.vgrow="NEVER">
                <VBox styleClass="widget-card" spacing="8">
                    <Label text="Statuts" styleClass="widget-title"/>
                    <HBox spacing="6" alignment="CENTER_LEFT">
                        <Label text="●" style="-fx-text-fill: #16A34A;"/>
                        <Label text="Ok:" styleClass="muted-text"/>
                        <Label fx:id="statusOkCountLabel" text="0" styleClass="widget-value"/>
                    </HBox>
                    <HBox spacing="6" alignment="CENTER_LEFT">
                        <Label text="●" style="-fx-text-fill: #F59E0B;"/>
                        <Label text="Maintenance:" styleClass="muted-text"/>
                        <Label fx:id="statusMaintenanceCountLabel" text="0" styleClass="widget-value"/>
                    </HBox>
                    <HBox spacing="6" alignment="CENTER_LEFT">
                        <Label text="●" style="-fx-text-fill: #DC2626;"/>
                        <Label text="Manque:" styleClass="muted-text"/>
                        <Label fx:id="statusManqueCountLabel" text="0" styleClass="widget-value"/>
                    </HBox>
                </VBox>

                <VBox styleClass="widget-card" spacing="8">
                    <Label text="Top Lieux" styleClass="widget-title"/>
                    <Label fx:id="topLieuxLabel" text="-" styleClass="widget-list" wrapText="true"/>
                </VBox>

                <VBox styleClass="widget-card" spacing="8">
                    <Label text="Sites" styleClass="widget-title"/>
                    <Label fx:id="siteDistributionLabel" text="-" styleClass="widget-list" wrapText="true"/>
                </VBox>

                <VBox styleClass="widget-card" spacing="8">
                    <Label text="Qualite Donnees" styleClass="widget-title"/>
                    <Label fx:id="garantieCountLabel" text="-" styleClass="widget-list" wrapText="true"/>
                    <Label fx:id="networkCoverageLabel" text="-" styleClass="widget-list" wrapText="true"/>
                    <Label fx:id="lastUpdateLabel" text="-" styleClass="muted-text" wrapText="true"/>
                </VBox>
            </TilePane>
        </VBox>
    </center>

    <padding>
        <Insets top="12" right="12" bottom="12" left="12"/>
    </padding>
</BorderPane>
